<script>
    document.getElementById("loginForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent the form from submitting normally
        
        // Get the values of email and password
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        
        // Validate email and password fields
        if (!email || !password) {
            var loginFeedback = document.getElementById("loginFeedback");
            loginFeedback.innerText = "Please enter both email and password.";
            loginFeedback.style.display = "block";
            return;
        }
        
        // Show login feedback
        var loginFeedback = document.getElementById("loginFeedback");
        loginFeedback.style.display = "none";
        
        // Send the login request to the backend server
        axios.post("/login", { email: email, password: password })
            .then(function(response) {
                // Store the token securely (e.g., in local storage)
                localStorage.setItem("token", response.data.token);
                // Redirect to the dashboard page
                window.location.href = "dashboard.html";
            })
            .catch(function(error) {
                // Handle login error
                console.error("Login error:", error);
                if (error.response && error.response.status === 401) {
                    // Unauthorized: Token expired or authentication failed
                    // Redirect to dashboard page without authentication
                    window.location.href = "dashboard.html";
                } else {
                    loginFeedback.innerText = "An error occurred while logging in. Please try again later.";
                    loginFeedback.style.display = "block";
                }
            });
    });

    // Function to refresh token
    function refreshToken() {
        axios.get('http://localhost:3000/refreshToken')
            .then(response => {
                const { token } = response.data;
                localStorage.setItem('token', token);
                hideWarning();
                // Redirect to dashboard page after refreshing token
                window.location.href = 'dashboard.html';
            })
            .catch(error => {
                console.error('Error refreshing token:', error);
            });
    }

    // Function to display token expiry warning
    function showWarning() {
        document.getElementById('expirationWarning').style.display = 'block';
        tokenExpirationWarningTimer = setTimeout(hideWarning, 20000); // Hide warning after 20 seconds
    }

    // Function to hide token expiry warning
    function hideWarning() {
        document.getElementById('expirationWarning').style.display = 'none';
        clearTimeout(tokenExpirationWarningTimer);
    }

    // Check token expiration when the page loads
    checkTokenExpiration();
</script>
